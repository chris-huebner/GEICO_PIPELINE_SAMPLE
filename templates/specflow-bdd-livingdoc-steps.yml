#
# Template with steps for generating livingdoc for the given BDD Project name 
#

parameters:

- name: testAssemblyPath
  type: string
  default: ''
- 
  name: livingDocFile
  type: string
  default: 'LivingDoc-$(Build.BuildId).html'
- 
  name: ContinueOnError
  type: boolean
  default: false


steps:

- task: CmdLine@2
  displayName: 'Run all BDD tests' 
  continueOnError: ${{ parameters.ContinueOnError }}
  inputs:
      script: |         
          echo "$(Build.SourcesDirectory)"  
          dotnet test ${{ parameters.testAssemblyPath }}

- task: CmdLine@2
  displayName: 'Generate Living Doc report' 
  continueOnError: ${{ parameters.ContinueOnError }}
  inputs:
      script: |
        echo 'Generate Living Doc Report'
        livingdoc test-assembly ${{ parameters.testAssemblyPath }} -t $(Build.sourcesDirectory)/src/Tests/Rating.Tests.BDD/bin/Release/net6.0/TestExecution.json -o $(Build.ArtifactStagingDirectory)   
    
- task: CmdLine@2
  displayName: 'Rename LivingDoc.html' 
  continueOnError: ${{ parameters.ContinueOnError }}
  inputs:
      script: 'mv $(build.artifactstagingdirectory)/LivingDoc.html  ${{ parameters.livingDocFile }}'

- publish: '$(Build.sourcesDirectory)/${{ parameters.livingDocFile }}'
  artifact: LivingDoc